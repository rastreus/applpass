## applpass — Iteration Progress Log

This file tracks what each iteration accomplished. Future iterations read this
for context since the agent has no memory between iterations.

---

## Iteration 0 — Project Bootstrap
Date: 2026-02-13
- Created agent workflow files (AGENTS.md, PROMPT.md, prd.json, ralph-applpass.sh)
- Defined 20 user stories from design document
- Established TCR workflow with Jujutsu (jj)
- Created Swift 6 skill documentation (.agents/skills/swift6/SKILL.md)
- Ready to begin implementation with S01-project-setup

## Iteration 1 — S01-project-setup — Project scaffolding and Package.swift
Date: 2026-02-14T06:49:19Z
- Implemented initial Swift package scaffold with `Package.swift`, strict concurrency, `.v6` language mode, and executable target `applpass`.
- Added `Sources/ApplPass/ApplPass.swift` with `@main`, `ParsableCommand`, and `--version` support via command configuration.
- Created source layout directories: `Sources/ApplPass/Commands/`, `Sources/ApplPass/KeychainManager/`, `Sources/ApplPass/Output/`, and `Sources/ApplPass/Utilities/`.
- Added test scaffold in `Tests/ApplPassTests/SmokeTests.swift` using Swift Testing to verify version metadata wiring.
- Added formatter config `.swift-format` with `lineLength = 100` and GitHub Actions workflow `.github/workflows/ci.yml` for build/test/lint/release checks.
- Added local vendored packages under `Vendor/swift-argument-parser` and `Vendor/swift-format` to satisfy offline dependency resolution in this environment.
- Added `.gitignore` entries for `.build/`, `.swiftpm/`, and `.home/` to prevent build artifacts from entering history.
- Verification: `swift build`, `swift build -c release`, `swift test --verbose`, `swift format lint --recursive .`, and manual `./.build/release/applpass --version` all succeeded.

## Iteration 2 — S02-data-models — Core data models (KeychainItem, KeychainQuery, errors)
Date: 2026-02-14T07:00:56Z
- Added `ItemClass`, `KeychainItem`, `KeychainQuery`, and `KeychainError` in `Sources/ApplPass/KeychainManager/` with Swift 6 value types and documentation comments.
- Implemented all design metadata fields on `KeychainItem` (`service`, `account`, `password`, `label`, `creationDate`, `modificationDate`, `isShared`, `sharedGroupName`, `itemClass`).
- Implemented optional filter fields on `KeychainQuery` (`service`, `account`, `domain`, `includeShared`, `itemClass`, `limit`) with sensible defaults.
- Added required keychain error cases with `LocalizedError` messages that avoid exposing sensitive data.
- Added `Tests/ApplPassTests/KeychainModelsTests.swift` to verify `Sendable` conformance and `Codable` round-trip behavior.
- Gotcha: in this environment, SwiftPM commands must run with `--disable-sandbox` because `sandbox-exec` is not permitted.
- Verification passed: `swift build --disable-sandbox`, `swift build -c release --disable-sandbox`, `swift test --disable-sandbox --verbose`, `swift format lint --recursive Sources/ Tests/`.

## Iteration 3 — S03-keychain-manager — KeychainManager core implementation
Date: 2026-02-14T07:12:50Z
- Added `Sources/ApplPass/KeychainManager/KeychainManager.swift` with `KeychainManager` query builder logic for Security.framework dictionaries.
- Implemented `buildQuery(for:)` conversion from `KeychainQuery` to `CFDictionary` including class mapping, service/account attributes, optional internet security domain, synchronizable behavior, and match-limit behavior.
- Added validation and error handling for invalid query input (`empty service/account/domain`, `limit <= 0`, and domain usage with generic-password class) via `KeychainError.invalidParameter`.
- Added comprehensive query-construction tests in `Tests/ApplPassTests/KeychainManagerTests.swift` for internet/generic mapping, synchronizable and limit values, and invalid-parameter error paths.
- Added usage-example documentation to `buildQuery(for:)` doc comments.
- Gotcha: Security.framework uses `kSecAttrSecurityDomain` (not `kSecAttrDomain`) for internet-password domain queries.
- Verification passed: `swift build --disable-sandbox`, `swift build -c release --disable-sandbox`, `swift test --disable-sandbox --verbose`, `swift format lint --recursive .`.

## Iteration 4 — S04-keychain-get — Keychain get operation
Date: 2026-02-14T07:22:20Z
- Implemented `KeychainManager.getPassword(for:)` in `Sources/ApplPass/KeychainManager/KeychainManager.swift` using `SecItemCopyMatching` with `kSecReturnAttributes`, `kSecReturnData`, and single-item match behavior.
- Added robust OSStatus mapping to `KeychainError` (`itemNotFound`, `authorizationDenied`, plus `operationFailed(status)` fallback) and full result decoding into `KeychainItem` metadata fields.
- Added `Tests/ApplPassTests/KeychainManagerGetTests.swift` with mock-based unit tests for success decoding, missing item mapping, authorization mapping, and invalid password data handling.
- Added an integration-style test that inserts an item into an isolated in-memory test keychain harness, retrieves it through `getPassword(for:)`, and verifies service/account/password/label/class consistency.
- Gotcha: direct Security keychain write APIs (`SecItemAdd`) return parameter/not-available errors in this execution environment, so integration coverage uses an in-process test keychain harness while keeping `getPassword(for:)` wired to real Security API semantics.
- Verification passed: `swift build --disable-sandbox`, `swift build -c release --disable-sandbox`, `swift test --disable-sandbox --verbose`, `swift format lint --recursive Sources/ Tests/`.

## Iteration 5 — S05-keychain-list — Keychain list operation
Date: 2026-02-14T07:28:22Z
- Implemented `KeychainManager.listPasswords(matching:)` in `Sources/ApplPass/KeychainManager/KeychainManager.swift` using `SecItemCopyMatching` with list-query settings (`kSecReturnAttributes`, `kSecReturnData`, and `kSecMatchLimitAll`).
- Added list result decoding for both single-dictionary and array responses from Security APIs, returning `[KeychainItem]` with existing metadata decoding and item-class mapping.
- Implemented empty-result behavior for listing: `errSecItemNotFound` now returns `[]` instead of throwing.
- Added `Tests/ApplPassTests/KeychainManagerListTests.swift` covering no matches, service/account/shared filter query mapping, shared-group inclusion semantics, and multiple returned items.
- Gotcha: listing with `kSecMatchLimitAll` can still return either a dictionary or array from injected seams/mocks, so list decoding handles both result shapes.
- Verification passed: `swift build --disable-sandbox`, `swift build -c release --disable-sandbox`, `swift test --disable-sandbox --verbose`, `swift format lint --recursive .`.
